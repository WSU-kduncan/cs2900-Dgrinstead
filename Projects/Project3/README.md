

# There are a couple of different mounts when you are using Docker. Bind and Volume Mounts

* Bind Mount: When you use a bind mount, a file or directory on the host machine is mounted into a container. The file or directory is referenced by its absolute path on the host machine.


* Volume Mount: Volumes are going to be the preferred mechanism for persisting data generated by and used by docker
containers. Volumes are managed by docker.


1. The first step you want to do is set your command

2. $ docker run -d \

3. -it \

--name devtest \
--mount type=bind,source="$(pwd)"/target,target=/app \
nginx:latest 

4. Use docker inspect devtest to verify that the bind mount was created correctly. Look for the Mounts section:

## This is the command

"Mounts": [

    {
	"Type": "bind",
	"Source": "/tmp/source/target",
	"Destination": "/app",
	"Mode": "",
	"RW": true,
	"Propagation": "rprivate"
    }
],

* What this does is it shows that the mount is a bind mount, it shows the  correct source and destination,
it shows that the mount is read-write, and that the propogation is set to rprivate



# Volume Mount

* Volumes are going to be the preferred mechanism for persisting data generated by and used by Docker Containers. What
the difference between bind mounts and volumes are volumes are managed by Docker.

## Some advantages are

- Volumes are easier to back up or migrate than bind mounts
- You can manage volumes using Docker CLI commands or the Docker API
- Volume drivers let you store volumes on remote hosts or cloud providers, to encrypt the contents of volumes, or to add funtionalit

## This is going to be a set of commands to Create, List, Inspect, and Remove a volume



## Create

* $ docker volume create my-vol


## List Volumes:

* $ docker volume ls
local             my-vol



## Inspect a volume

* $ docker volume inspect my-vol

[ 


	{ 

	     "Driver": "local",
	     "Labels": {},
	     "Mountpoint": "/var/lib/docker/volume/my-vol/_data",
             "Name": "my-vol",
	     "Options": {},
   	     "Scope": "local"
]       }



## Remove A volume

* $ docker volume rm my-vol




## Docker Build Tools


* For docker there is a service called BuildKit



## How to use buildKit

* $ DOCKER_BUILDKIT=1 docker build

* If you want to enable dockerBuildKit by default, set daemon configuration in /etc/docker/daemon.json
- { "features": {"buildkit": true } }

 
# How to write a build file


 syntax=docker/dockerfile:1
 FROM node:12-alpine
 RUN apk add --no-cache python g++ make
 WORKDIR /app
 COPY . . 
 RUN yarn install --production
 CMD ["node", "src/index.js"]






# Kubernates

## AWSElasticBlockStore
- This type of volume mounts an Amazon Web Services volume into your pod. Unlike, which is erased when a pod is removed,
the contents of an EBS volume are persisted and the volume is unmounted. This means that an EBS volume can be pre-populated with data, and that data can be shared between pods

## azureDisk
- The azureDisk volume type mounts a Microsoft Azure Data Disk into a pod.


## Restrictions 
- the nodes on which pods are running must be AWS EC2 instances
- those instances need to be in the same region and availability zone as the EBS volume
- EBS only supports a single EC2 instance mounting a volume


# Creating an AWS EBS volume

* aws ec2 create-volume --availability-zone=eu-west-1a --size=10 --volume-type=gp2

# Build tools for Azure

  trigger:
        - main

        pool:
          vmImage: 'ubuntu-latest' # set to windows-latest or another Windows vmImage for Windows builds

        variables:
          imageName: 'pipelines-javascript-docker'

        steps:
        - task: Docker@2
          displayName: Build an image
          inputs:
            repository: $(imageName)
            command: build
            Dockerfile: app/Dockerfile
